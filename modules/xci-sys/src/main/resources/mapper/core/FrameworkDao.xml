<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2007-2020 西安交通信息投资营运有限公司 版权所有
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.github.lvyanyang.internal.FrameworkDao">
     <!--查询机构以及所有下级的主键-->
    <!--sqlserver:select dept_id from fnGetDeptLower(${deptId},1)-->
    <!--oracle:select dept_id from sys_dept start with dept_id = ${deptId} connect by prior dept_id = parent_id-->
    <!--mysql:select dept_id from sys_department where find_in_set(id, fnGetDeptLower('${deptId}',1))-->
    <sql id="selectDeptAndLower">
        <if test='_databaseId == "sqlserver"'>
            select id from fnGetDeptLower(${deptId},1)
        </if>
        <if test='_databaseId == "oracle"'>
            select id from sys_dept start with id=${deptId} connect by prior id=parent_id
        </if>
        <if test='_databaseId == "mysql"'>
            select id from sys_dept where find_in_set(id, fnGetDeptLower('${deptId}',1))
        </if>
    </sql>

    <!--机构数据权限-->
    <sql id="deptScope">
        <if test="filter.params.containsKey('deptScopeSql')">
            ${filter.params.deptScopeSql}
        </if>
    </sql>
</mapper>